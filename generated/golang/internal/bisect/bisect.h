// generated by GoCpp from file '$(ImportDir)/internal/bisect/bisect.go'
#pragma once

#include <functional>
#include <string>
#include <tuple>
#include <vector>

#include "golang/internal/bisect/bisect.fwd.h"
#include "gocpp/support.h"

#include "golang/sync/mutex.h"

namespace golang::bisect
{
    std::tuple<Matcher*, std::string> New(std::string pattern);
    struct Matcher
    {
        bool verbose;
        bool quiet;
        bool enable;
        gocpp::slice<cond> list;
        /* atomicPointerDedup dedup; [Known incomplete type] */

        using isGoStruct = void;

        std::ostream& PrintTo(std::ostream& os) const;
    };

    std::ostream& operator<<(std::ostream& os, const struct Matcher& value);
    struct atomicPointerDedup
    {
        unsafe::Pointer p;

        using isGoStruct = void;

        std::ostream& PrintTo(std::ostream& os) const;
    };

    std::ostream& operator<<(std::ostream& os, const struct atomicPointerDedup& value);
    dedup* Load(struct atomicPointerDedup* p);
    bool CompareAndSwap(struct atomicPointerDedup* p, dedup* old, dedup* go_new);
    struct cond
    {
        uint64_t mask;
        uint64_t bits;
        bool result;

        using isGoStruct = void;

        std::ostream& PrintTo(std::ostream& os) const;
    };

    std::ostream& operator<<(std::ostream& os, const struct cond& value);
    bool MarkerOnly(struct Matcher* m);
    bool ShouldEnable(struct Matcher* m, uint64_t id);
    bool ShouldPrint(struct Matcher* m, uint64_t id);
    bool matchResult(struct Matcher* m, uint64_t id);
    bool FileLine(struct Matcher* m, Writer w, std::string file, int line);
    bool fileLine(struct Matcher* m, Writer w, std::string file, int line);
    std::string printFileLine(Writer w, uint64_t h, std::string file, int line);
    gocpp::slice<unsigned char> appendFileLine(gocpp::slice<unsigned char> dst, std::string file, int line);
    bool Stack(struct Matcher* m, Writer w);
    bool stack(struct Matcher* m, Writer w);
    struct Writer : gocpp::Interface
    {
        Writer(){}
        Writer(Writer& i) = default;
        Writer(const Writer& i) = default;
        Writer& operator=(Writer& i) = default;
        Writer& operator=(const Writer& i) = default;

        template<typename T>
        Writer(T& ref);

        template<typename T>
        Writer(const T& ref);

        template<typename T>
        Writer(T* ptr);

        using isGoStruct = void;

        std::ostream& PrintTo(std::ostream& os) const;

        struct IWriter
        {
            virtual std::tuple<int, std::string> vWrite(gocpp::slice<unsigned char>) = 0;
        };

        template<typename T, typename StoreT>
        struct WriterImpl : IWriter
        {
            explicit WriterImpl(T* ptr)
            {
                value.reset(ptr);
            }

            std::tuple<int, std::string> vWrite(gocpp::slice<unsigned char>) override;

            StoreT value;
        };

        std::shared_ptr<IWriter> value;
    };

    std::tuple<int, std::string> Write(const gocpp::PtrRecv<Writer, false>& self, gocpp::slice<unsigned char>);
    std::tuple<int, std::string> Write(const gocpp::ObjRecv<Writer>& self, gocpp::slice<unsigned char>);

    std::ostream& operator<<(std::ostream& os, const struct Writer& value);
    std::string PrintMarker(Writer w, uint64_t h);
    std::string printStack(Writer w, uint64_t h, gocpp::slice<uintptr_t> stk);
    std::string Marker(uint64_t id);
    gocpp::slice<unsigned char> AppendMarker(gocpp::slice<unsigned char> dst, uint64_t id);
    std::tuple<std::string, uint64_t, bool> CutMarker(std::string line);
    uint64_t Hash(gocpp::slice<go_any> data);

    template<typename... Args>
    uint64_t Hash(Args... data)
    {
        return Hash(gocpp::ToSlice<go_any>(data...));
    }

    struct parseError
    {
        std::string text;

        using isGoStruct = void;

        std::ostream& PrintTo(std::ostream& os) const;
    };

    std::ostream& operator<<(std::ostream& os, const struct parseError& value);
    std::string Error(struct parseError* e);
    uint64_t fnv(uint64_t h, unsigned char x);
    uint64_t fnvString(uint64_t h, std::string x);
    uint64_t fnvUint64(uint64_t h, uint64_t x);
    uint64_t fnvUint32(uint64_t h, uint32_t x);
    struct dedup
    {
        gocpp::array<gocpp::array<uint64_t, 4>, 128> recent;
        mocklib::Mutex mu;
        gocpp::map<uint64_t, bool> m;

        using isGoStruct = void;

        std::ostream& PrintTo(std::ostream& os) const;
    };

    std::ostream& operator<<(std::ostream& os, const struct dedup& value);
    bool seen(struct dedup* d, uint64_t h);
    bool seenLossy(struct dedup* d, uint64_t h);
}

