// generated by GoCpp from file '$(ImportDir)/internal/poll/fd_windows.go'
#pragma once

#include <functional>
#include <string>
#include <tuple>
#include <vector>

#include "golang/internal/poll/fd_windows.fwd.h"
#include "gocpp/support.h"

#include "golang/internal/poll/fd_mutex.h"
#include "golang/internal/poll/fd_poll_runtime.h"
#include "golang/internal/syscall/windows/syscall_windows.h"
#include "golang/sync/mutex.h"
#include "golang/syscall/syscall_windows.h"
#include "golang/syscall/types_windows.h"

namespace golang::poll
{
    extern gocpp::error initErr;
    extern uint64_t ioSync;
    extern bool useSetFileCompletionNotificationModes;
    void checkSetFileCompletionNotificationModes();
    void init();
    struct operation
    {
        syscall::Overlapped o;
        uintptr_t runtimeCtx;
        int32_t mode;
        int32_t errno;
        uint32_t qty;
        FD* fd;
        syscall::WSABuf buf;
        windows::WSAMsg msg;
        syscall::Sockaddr sa;
        syscall::RawSockaddrAny* rsa;
        int32_t rsan;
        syscall::Handle handle;
        uint32_t flags;
        gocpp::slice<syscall::WSABuf> bufs;

        using isGoStruct = void;

        template<typename T> requires gocpp::GoStruct<T>
        operator T();

        template<typename T> requires gocpp::GoStruct<T>
        bool operator==(const T& ref) const;

        std::ostream& PrintTo(std::ostream& os) const;
    };

    std::ostream& operator<<(std::ostream& os, const struct operation& value);
    std::tuple<int, struct gocpp::error> execIO(struct operation* o, std::function<struct gocpp::error (struct operation* o)> submit);
    extern std::function<gocpp::error (syscall::Handle, *uint16, uint32_t, *uint32, *byte)> ReadConsole;
    int32_t sockaddrInet4ToRaw(syscall::RawSockaddrAny* rsa, syscall::SockaddrInet4* sa);
    int32_t sockaddrInet6ToRaw(syscall::RawSockaddrAny* rsa, syscall::SockaddrInet6* sa);
    void rawToSockaddrInet4(syscall::RawSockaddrAny* rsa, syscall::SockaddrInet4* sa);
    void rawToSockaddrInet6(syscall::RawSockaddrAny* rsa, syscall::SockaddrInet6* sa);
    std::tuple<int32_t, struct gocpp::error> sockaddrToRaw(syscall::RawSockaddrAny* rsa, syscall::Sockaddr sa);
    struct FD
    {
        fdMutex fdmu;
        syscall::Handle Sysfd;
        operation rop;
        operation wop;
        pollDesc pd;
        mocklib::Mutex l;
        gocpp::slice<unsigned char> lastbits;
        gocpp::slice<uint16_t> readuint16;
        gocpp::slice<unsigned char> readbyte;
        int readbyteOffset;
        uint32_t csema;
        bool skipSyncNotif;
        bool IsStream;
        bool ZeroReadIsEOF;
        bool isFile;
        golang::poll::fileKind kind;

        using isGoStruct = void;

        template<typename T> requires gocpp::GoStruct<T>
        operator T();

        template<typename T> requires gocpp::GoStruct<T>
        bool operator==(const T& ref) const;

        std::ostream& PrintTo(std::ostream& os) const;
    };

    std::ostream& operator<<(std::ostream& os, const struct FD& value);
    extern std::function<void (gocpp::string net, struct FD* fd, struct gocpp::error err)> logInitFD;

    namespace rec
    {
        void InitBuf(golang::poll::operation* o, gocpp::slice<unsigned char> buf);
        void InitBufs(golang::poll::operation* o, gocpp::slice<gocpp::slice<unsigned char>>* buf);
        void ClearBufs(golang::poll::operation* o);
        void InitMsg(golang::poll::operation* o, gocpp::slice<unsigned char> p, gocpp::slice<unsigned char> oob);
        std::tuple<gocpp::string, struct gocpp::error> Init(golang::poll::FD* fd, gocpp::string net, bool pollable);
        struct gocpp::error destroy(golang::poll::FD* fd);
        struct gocpp::error Close(golang::poll::FD* fd);
        std::tuple<int, struct gocpp::error> Read(golang::poll::FD* fd, gocpp::slice<unsigned char> buf);
        std::tuple<int, struct gocpp::error> readConsole(golang::poll::FD* fd, gocpp::slice<unsigned char> b);
        std::tuple<int, struct gocpp::error> Pread(golang::poll::FD* fd, gocpp::slice<unsigned char> b, int64_t off);
        std::tuple<int, syscall::Sockaddr, struct gocpp::error> ReadFrom(golang::poll::FD* fd, gocpp::slice<unsigned char> buf);
        std::tuple<int, struct gocpp::error> ReadFromInet4(golang::poll::FD* fd, gocpp::slice<unsigned char> buf, syscall::SockaddrInet4* sa4);
        std::tuple<int, struct gocpp::error> ReadFromInet6(golang::poll::FD* fd, gocpp::slice<unsigned char> buf, syscall::SockaddrInet6* sa6);
        std::tuple<int, struct gocpp::error> Write(golang::poll::FD* fd, gocpp::slice<unsigned char> buf);
        std::tuple<int, struct gocpp::error> writeConsole(golang::poll::FD* fd, gocpp::slice<unsigned char> b);
        std::tuple<int, struct gocpp::error> Pwrite(golang::poll::FD* fd, gocpp::slice<unsigned char> buf, int64_t off);
        std::tuple<int64_t, struct gocpp::error> Writev(golang::poll::FD* fd, gocpp::slice<gocpp::slice<unsigned char>>* buf);
        std::tuple<int, struct gocpp::error> WriteTo(golang::poll::FD* fd, gocpp::slice<unsigned char> buf, syscall::Sockaddr sa);
        std::tuple<int, struct gocpp::error> WriteToInet4(golang::poll::FD* fd, gocpp::slice<unsigned char> buf, syscall::SockaddrInet4* sa4);
        std::tuple<int, struct gocpp::error> WriteToInet6(golang::poll::FD* fd, gocpp::slice<unsigned char> buf, syscall::SockaddrInet6* sa6);
        struct gocpp::error ConnectEx(golang::poll::FD* fd, syscall::Sockaddr ra);
        std::tuple<gocpp::string, struct gocpp::error> acceptOne(golang::poll::FD* fd, syscall::Handle s, gocpp::slice<syscall::RawSockaddrAny> rawsa, struct operation* o);
        std::tuple<syscall::Handle, gocpp::slice<syscall::RawSockaddrAny>, uint32_t, gocpp::string, struct gocpp::error> Accept(golang::poll::FD* fd, std::function<std::tuple<syscall::Handle, struct gocpp::error> ()> sysSocket);
        std::tuple<int64_t, struct gocpp::error> Seek(golang::poll::FD* fd, int64_t offset, int whence);
        struct gocpp::error Fchmod(golang::poll::FD* fd, uint32_t mode);
        struct gocpp::error Fchdir(golang::poll::FD* fd);
        std::tuple<uint32_t, struct gocpp::error> GetFileType(golang::poll::FD* fd);
        struct gocpp::error GetFileInformationByHandle(golang::poll::FD* fd, syscall::ByHandleFileInformation* data);
        struct gocpp::error RawRead(golang::poll::FD* fd, std::function<bool (uintptr_t _1)> f);
        struct gocpp::error RawWrite(golang::poll::FD* fd, std::function<bool (uintptr_t _1)> f);
        std::tuple<int, int, int, syscall::Sockaddr, struct gocpp::error> ReadMsg(golang::poll::FD* fd, gocpp::slice<unsigned char> p, gocpp::slice<unsigned char> oob, int flags);
        std::tuple<int, int, int, struct gocpp::error> ReadMsgInet4(golang::poll::FD* fd, gocpp::slice<unsigned char> p, gocpp::slice<unsigned char> oob, int flags, syscall::SockaddrInet4* sa4);
        std::tuple<int, int, int, struct gocpp::error> ReadMsgInet6(golang::poll::FD* fd, gocpp::slice<unsigned char> p, gocpp::slice<unsigned char> oob, int flags, syscall::SockaddrInet6* sa6);
        std::tuple<int, int, struct gocpp::error> WriteMsg(golang::poll::FD* fd, gocpp::slice<unsigned char> p, gocpp::slice<unsigned char> oob, syscall::Sockaddr sa);
        std::tuple<int, int, struct gocpp::error> WriteMsgInet4(golang::poll::FD* fd, gocpp::slice<unsigned char> p, gocpp::slice<unsigned char> oob, syscall::SockaddrInet4* sa);
        std::tuple<int, int, struct gocpp::error> WriteMsgInet6(golang::poll::FD* fd, gocpp::slice<unsigned char> p, gocpp::slice<unsigned char> oob, syscall::SockaddrInet6* sa);
    }
}

