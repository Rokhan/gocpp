// generated by GoCpp from file '$(ImportDir)/runtime/tagptr_64bit.go'
#include <complex>
#include <functional>
#include <iostream>
#include <iomanip>
#include <map>
#include <string>
#include <tuple>
#include <vector>

#include "golang/runtime/tagptr_64bit.h"
#include "gocpp/support.h"

#include "golang/internal/goarch/zgoarch_amd64.h"
#include "golang/internal/goos/zgoos_windows.h"
#include "golang/runtime/extern.h"
#include "golang/runtime/panic.h"
#include "golang/runtime/tagptr.h"
#include "golang/unsafe/unsafe.h"

namespace golang::runtime
{
    namespace rec
    {
        using namespace mocklib::rec;
    }

    runtime::taggedPointer taggedPointerPack(unsafe::Pointer ptr, uintptr_t tag)
    {
        if(GOOS == "aix")
        {
            if(GOARCH != "ppc64")
            {
                go_throw("check this code for aix on non-ppc64");
            }
            return taggedPointer((uint64_t(uintptr_t(ptr)) << (64 - aixAddrBits)) | uint64_t(tag & ((1 << aixTagBits) - 1)));
        }
        if(GOARCH == "riscv64")
        {
            return taggedPointer((uint64_t(uintptr_t(ptr)) << (64 - riscv64AddrBits)) | uint64_t(tag & ((1 << riscv64TagBits) - 1)));
        }
        return taggedPointer((uint64_t(uintptr_t(ptr)) << (64 - addrBits)) | uint64_t(tag & ((1 << tagBits) - 1)));
    }

    unsafe::Pointer rec::pointer(golang::runtime::taggedPointer tp)
    {
        if(GOARCH == "amd64")
        {
            return unsafe::Pointer(uintptr_t((int64_t(tp) >> tagBits) << 3));
        }
        if(GOOS == "aix")
        {
            return unsafe::Pointer(uintptr_t(((tp >> aixTagBits) << 3) | (0xa << 56)));
        }
        if(GOARCH == "riscv64")
        {
            return unsafe::Pointer(uintptr_t((tp >> riscv64TagBits) << 3));
        }
        return unsafe::Pointer(uintptr_t((tp >> tagBits) << 3));
    }

    uintptr_t rec::tag(golang::runtime::taggedPointer tp)
    {
        return uintptr_t(tp & ((1 << taggedPointerBits) - 1));
    }

}

